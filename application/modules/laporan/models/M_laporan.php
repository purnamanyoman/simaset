<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class M_laporan extends CI_Model {
	 function get_hasil_ruangan($data) {			$sql=$this->db->query("select a.*,b.*,c.*,year(tgl_perlh)as tahunperoleh from tb_barang_ruang a,tb_aset b,t_sskel c where a.kd_brg=b.kd_brg and a.no_aset=b.no_aset and a.kd_brg=c.kd_brg and a.flag_delete=0  and a.id_ruangan='".$data['id_ruang']."'");					return $sql->result();		}function getNamaRuang($data) {			$sql=$this->db->query("select nama_ruangan from tb_ruangan where id_ruangan='".$data."'");					return $sql->row();		}function getNamaPeriode($data) { 			$sql=$this->db->query("select nama  from tb_periode where id='".$data."' ");					return $sql->row();		} function getPeriodeAwal($data) { 			$sql=$this->db->query("select tanggal_awal  from tb_periode where id='".$data."' ");					return $sql->row();		} 		function getPeriodeAkhir($data) { 			$sql=$this->db->query("select tanggal_akhir  from tb_periode where id='".$data."' ");					return $sql->row();		} 		function jumlahBarangRegister($kd_brg, $no_register){	$sql=$this->db->query("select * from tb_aset  where  kd_brg='".$kd_brg."'   and no_sppa='".$no_register."'");					return $sql->num_rows();}function getAsetKurangBaik($kd_brg,$no_sppa){		$sql=$this->db->query("select * from tb_ubah_status a,tb_aset b where  a.kd_brg='".$kd_brg."'   and b.no_sppa='".$no_sppa."' and a.kd_brg=b.kd_brg and a.no_aset=b.no_aset and a.id_status_baru=5  order by id desc limit 1");						return $sql->num_rows();}function getAsetBaik($kd_brg,$no_sppa){	$sql=$this->db->query("select * from tb_ubah_status a,tb_aset b where  a.kd_brg='".$kd_brg."'   and b.no_sppa='".$no_sppa."' and a.kd_brg=b.kd_brg and a.no_aset=b.no_aset and a.id_status_baru=1  order by id desc limit 1");						return $sql->num_rows();}function getAsetRusakBerat($kd_brg,$no_sppa){	$sql=$this->db->query("select * from tb_ubah_status a,tb_aset b where  a.kd_brg='".$kd_brg."'   and b.no_sppa='".$no_sppa."' and a.kd_brg=b.kd_brg and a.no_aset=b.no_aset and a.id_status_baru=6 order by id desc limit 1");						return $sql->num_rows();}function getKeadaanBarang($kode_barang){			$sql=$this->db->query("select  singkatan from tb_ubah_status a,status b where a.kd_brg='".$kode_barang."' and a.id_status_baru=b.status order by id desc");	 			if($sql->row()==NULL)				$keadaan="B";			else				$keadaan=$sql->row()->singkatan;			return $keadaan;}function getJumlahBarangAwal($id_periode,$kd_brg){			$sql=$this->db->query("select  count(*) as jumlah from tb_aset a,tb_periode b where b.id='".$id_periode."' and a.tgl_perlh<b.tanggal_awal and a.kd_brg='".$kd_brg."'");				if($sql->row()->jumlah<=0)				$jumlahhasil=0;			else				$jumlahhasil=$sql->row()->jumlah;			return $jumlahhasil;	}function getPenambahanBarangDalamPeriode($id_periode,$kd_brg){			$sql=$this->db->query("select  count(*) as jumlah from tb_aset a,tb_periode b where b.id='".$id_periode."' and a.tgl_perlh>=b.tanggal_awal and a.tgl_perlh<=b.tanggal_akhir and a.kd_brg='".$kd_brg."'");				if($sql->row()->jumlah<=0)				$jumlahhasil=0;			else				$jumlahhasil=$sql->row()->jumlah;			return $jumlahhasil;}function getPenguranganBarangDalamPeriode($id_periode,$kd_brg){					$sql=$this->db->query("select  * from tb_aset a,tb_periode b,tb_ubah_status c where b.id='".$id_periode."' and a.tgl_perlh>=b.tanggal_awal and a.tgl_perlh<=b.tanggal_akhir and a.kd_brg='".$kd_brg."' and c.kd_brg=a.kd_brg and c.id_status_baru in (3,4,6) GROUP BY a.kd_brg"); 					if($sql->row()==NULL)				$jumlahhasil=0;			else				$jumlahhasil=$sql->num_rows();			return $jumlahhasil;}function get_hasil_mutasi($data) {				$sql=$this->db->query("select  b.*,c.*,year(tgl_perlh)as tahunperoleh from  tb_aset b,t_sskel c where   b.kd_brg=c.kd_brg and b.flag_delete=0 and  tgl_perlh >='".$data['periode_awal']."' and  tgl_perlh <='".$data['periode_akhir']."'  group by b.kd_brg");					return $sql->result();		}
}